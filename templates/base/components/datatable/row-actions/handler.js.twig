{# @copyright   Copyright (C) 2010-2022 Combodo SARL #}
{# @license     http://opensource.org/licenses/AGPL-3.0 #}

// for each row action...
{% for aAction in oUIBlock.GetRowActions() %}

    // register action buttons click
    $('#{{ oUIBlock.GetId() }} tbody').on('click', 'button[data-action-id="{{ loop.index0 }}"]', function() {

        // variables accessible from action row js
        let oDatatable = $('#{{ oUIBlock.GetId() }}').DataTable();
        let oTrElement = $(this).closest('tr');
        let iActionId = $(this).data('action-id');
        let aRowData = oDatatable.row(oTrElement).data();

        {% if aAction.confirmation is defined %}

            // Handle action row with confirmation modal
            let sMessage = '{{ 'UI:Datatables:RowActions:ConfirmationMessage'|dict_s }}';
            {% if aAction.confirmation.message is defined %}
                sMessage = '{{ aAction.confirmation.message|dict_s|raw }}';
            {% endif %}

            CombodoModal.OpenConfirmationModal({
                {#title: '{{ 'UI:Datatables:RowActions:ConfirmationDialog'|dict_s }}',#}
                content: sMessage.replaceAll('{item}', aRowData['{{ aAction.confirmation.message_row_data }}']),
                {% if aAction.confirmation.remember_choice_pref_key is defined %}
                user_preference_key: {{ aAction.confirmation.remember_choice_pref_key }},
                {% endif %}
            }, ActionRowFunction{{ oUIBlock.GetId() }}{{ loop.index0 }}, [oDatatable, oTrElement, iActionId, aRowData]);

        {% else %}

            // Handle action row without confirmation
            ActionRowFunction{{ oUIBlock.GetId() }}{{ loop.index0 }}(oDatatable, oTrElement, iActionId, aRowData);

        {% endif %}

    });

    // action row function declaration
    function ActionRowFunction{{ oUIBlock.GetId() }}{{ loop.index0 }}(oDatatable, oTrElement, iActionId, aRowData){

        console.log('oDatatable');
        console.log(oDatatable);
        console.log('oTrElement');
        console.log(oTrElement);
        console.log('iActionId');
        console.log(iActionId);
        console.log('aRowData');
        console.log(aRowData);

{#        {{ aAction.js_row_action|raw }};#}
        return true;
    }

{% endfor %}
